#		$Author: slavik $ $Date: 2006-03-27 02:20:41 +0600 $
#		$Id: Install.notes.txt 4 2006-03-26 20:20:41Z slavik $
--- Контакт для отчетов об ошибках и добавлений - mail#slavik@cybersec.ru ---

Замечания по версиям:
	STABLE, стабильная версия, для промышленного применения.
	RC, релиз кандидат, ветка зафиксирована, допускаются только багфиксы.
	PRE, тестовые релизы для поиска глюков и проблем, предшествуют выпуску RC
	CURRENT, текущая версия,может работать, может собиратся :)

Инструкция по установке:
0. Пункт пререквизитов, вы уже должны иметь установленными следующие программные пакеты:
0.1 Веб сервер apache версии 1.3.х, 2.0.х или 2.2.х, обязательное условие - модуль so
	 активирован, или сервер сразу собран с поддержкой php. 1)
0.2 Язык PHP версии >4.3.x, впрочем 5.0 и 5.1 тоже работают. 2)
0.3 СУБД MySQL версии не менее 4.1 (в 4.0 нет вложенных запросов), 5.0 - отлично.3)
0.4 Прокси сервер SquiD, версии 2.5 (можете поставить и 3.0, но по отзывам он сыроват) 4)
0.5 Если вы собираетесь использовать smbauth модуль то вам нужен пакет samba 2.2 или старше. 5)

1. Пункт подготовки, настройка программных пакетов.
1.1 В текущей версии включать RegisterGlobals необязательна
1.2 Обязательно убедитесь что php у вас с поддержкой mysql, и что он (если собран как модуль)
	подключен в текущей конфигурации apache.
1.3 Убедитесь что система знает где искать клиентскиую библиотеку mysql, если незнает - сделайте чтоб знала.
1.3.1 На линукс системах стоит проверить /etc/ld.so.conf , есть ли в ней каталог с библиотекой.
1.3.2 На openbsd и freebsd нужно выполнить команду "ldconfig -r|grep mysql" и найти библиотеку.
1.3.3 На солярисе поиск осуществляется через переменную среды.
1.4 Убедитесь что СУБД MySQL запускается и работает.
1.5 Убедитесь что желаемая схема авторизации SquiD у вас собрана и работает 6)
1.6 Убедитесь что логи которые производит squid в формате native, иначе их можно выкинуть. 7)
1.7 Убедитесь что вы незабыли создать каталог кэша squid.

2. Этап установки.
2.1 Первым делом я конечно рекомендую прочитать ./configure --help
2.2 Но так как все торопятся, будем надеятся что ./configure сама все поймет и найдет, я старался ;)
2.3 Собираем все и устанавливаем командой "make all install"
2.4 Обязательно проверьте $prefix/sacc/sql.log на предмет ошибок.
2.5 Исправьте squid.orig.conf на свои настройки кэша и авторизации.
2.5.1 Если вы используете схему NTSC то возможно вам понравится аддон chpasswd-ru, который позволяет пользователям самостоятельно менять свои пароли.
2.6 Может вам будут интересны скрипты автозапуска из каталога etc/init.d

3. Замечание по очередности запуска.
3.1 Самым первым запускаем СУБД MySQL, она будет некоторое время загружатся в фоне и не отвечать на запросы.
3.2 В это время мы будем загружать веб-сервер apache.
3.3 И потом уже запускать SAcc

4. Управление.
4.1 Первый вход на интерфейс управления.
4.1.1 Веб интерфейс находится по адресу http(s)://hostname/sacc/sa/ по умолчанию логин и пароль "admin/password"
4.1.2 Добавьте необходимые учетные записи администраторов системы.
4.1.3 Удалите учетную запись установленную по умолчанию.
4.1.4 Замечание: Вы несможете сменить пароль администратору, только удалить и снова создать.
4.2 Если на этапе 4.1 у вас что то не получилось - обязательно проверьте настройки
4.2.1 Настройки php, смотрим тут: http(s)://hostname/sacc/sa/check.php
4.3 Вход и управление пользователями
4.3.1 Вход на управление пользователями происходит через URL /sacc/admin

5. Пользователи
5.1 Пользователи заходят на URL /sacc/stat
5.2 Им предлагают ввести логин и пароль
5.3 С этими данными вызывается плагин авторизации (указывается в настройках)
5.4 Если он отдает "ОК" то пользователю показывается его текущая статистика.

6. Безопасность
6.1 Вебинтерфейс администратора потенциально небезопасен, т.е. зная логин и пароль в теории можно захватить контроль над сервером.
6.2 Вебинтерфейс пользователя безопасен, у пользователей нет возможности что-либо изменить.
6.3 В целях повышения безопасности я рекомендую запретить брандмауэром нелокальное использование СУБД MySQL

7. Внешние аутентификаторы, в принципе, если они у вас работают в squid то без проблем запустятся и тут, с аналогичными настройками.
7.1 Стандартные болячки
7.1.1 Указали несуществующий файл passwd.
7.1.2 Забыли положить proxyauth в шару NETLOGON контроллеров домена, или забыли дать права на чтение всем.

8. Проблемы... Все расписано в файле Troubleshooting.txt, добавить мне нечего.

9. Как это все работает, долго писать, работает и здорово.
10. Я сделал лучше! - поделись со мной, вместе мы сделаем ещё лучше.

Ну вот, вроде и все.
Best, 
Vyacheslav Nikitin 
Perm 27-03-2006
ссылки:
1) http://httpd.apache.org
2) http://www.php.net
3) http://dev.mysql.com
4) http://www.squid-cache.org
5) http://us2.samba.org/samba/
6) http://www.squid-cache.org/Doc/FAQ/FAQ-19.html#configuring-proxy-auth
7) http://www.squid-cache.org/Doc/FAQ/FAQ-6.html#ss6.6
8)
9)
